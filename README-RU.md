[![Build Status](https://github.com/Maslinin/Consyzer/workflows/Build/badge.svg)](https://github.com/Maslinin/Consyzer/actions/workflows/build.yml) [![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=Maslinin_Consyzer&metric=alert_status)](https://sonarcloud.io/summary/new_code?id=Maslinin_Consyzer) [![GitHub license](https://badgen.net/github/license/Maslinin/Consyzer)](https://github.com/Maslinin/Consyzer/blob/master/LICENSE)

# Описание
**Consyzer** - утилита, предназначенная для предотвращения проблем, связанных с нарушением консистентностии развернутых в системе CIL приложений или их модулей. 

## Для чего?
Допустим, что в исходном коде некоего приложения есть вызовы к функциям, находящимся в сторонних библиотеках динамической компоновки (DLL). 
Такие вызовы описываются с помощью инструкций **DllImport** в исходном коде программы и в последствии сохрананяются в метаданных приложения или его модуля.        
Ключевой особенностью таких инструкций импорта является то, 
что вызываемая из DLL функция не компонуется с исходным кодом модуля приложения; 
вместо этого в метаданных модуля сохраняется информация об импортируемой функции и местоположение модуля в системе, из которой эта функция импортируется.
Такой подход позволяет обращаться к нужному компоненту непосредственно во время выполнения программы.           

Когда все компоненты CIL модулей находятся там, где они и должны быть согласно метаданным, приложение работает корректно, не нарушая целостность и безопасности системы;
но если хотя бы один из модулей будет остутствовать, приложение не только завершит свою работу аварийно, но и может привести к нарушению безопасности всей системы.              
Consyzer был разработан специально для анализа и предотвращения подобных инцедентов.

## Преимущества Consyzer
1. *Consyzer* является независимым от GUI и легко запускается из *CLI*.
2. *Consyzer* может быть легко интегрирован в *конвейер CI/CD*.
3. *Consyzer* логгирует подробную информацию об анализе два потока: в консоль и файл одновременно.
4. *Consyzer* возвращает конкретный код анализа операционной системе, что позволяет настроить реагирование на каждый из инцидентов анализа.

## Какую информацию логгирует Consyzer об импортируемой функции?
Если *Consyzer* обнаружил внешную функцию, он логгирует следующую информацию об этой функции:
1. Имя функции,
2. Сигнатуру функции,
3. Местоположении модуля DLL, 
4. Аргументы атрибута DllImport.

## Коды возврата
> 0 - все вызываемые приложением модули находятся в анализируемой папке;       
> 1 - одна или несколько DLL, используемая в артефактах проекта, находится на абсолютном пути;        
> 2 - одна или несколько DLL, используемая в артефактах проекта, находится на относительном пути;        
> 3 - одна или несколько DLL, используемая в артефактах проекта, находится в системной папке приложения;        
> 4 - одна или несколько DLL, используемая в артефактах проекта, отсутствуют на пути, указанном в метаданных модуля.         

> Обратите внимание, что только последний из кодов возврата означает о нарушении консистентности приложения.

# Запуск    
В параметры командной строки утилите передается два параметра: 
1. Директория, содержащая CIL файлы для анализа;
2. Расширения файлов, подлежащих анализу.

Общий шаблон запуска *Consyzer* из CLI выглядит следующим образом:
```
pathToConsyzer pathsToFolderWithAnalysisFiles ExtensionsOfAnalysisFiles
```

Пример запуска *Consyzer* из CLI:

```
C:\Consyzer.exe C:\AnalysisFolder ".exe, .dll"
```

## Сканирование нескольких проектов
Вы можете использовать сценарий *PowerShell*, находящийся по пути ```Consyzer\DevOps\Runner.ps1``` для сканирования выходных артефактов решения с помощью *Consyzer*. 
Таким образом, данный сценарий позволяет провести сканирование артефактов сразу нескольких проектов.
Это может быть полезно при сканировании артефактов решения в *конвейере CI/CD*.

Сценарий сканирования принимает аргументы также, как если бы Вы запускали Consyzer из командной строки. 
Для того, что бы запустить сценарий сканирования, используйте следующую команду:

```Runner.ps1 C:\Consyzer.exe C:\SolutionForAnalysis ".exe, .dll" Release```, гдe         
1) *Runner.ps1* - имя сценария Powershell (или путь к нему),          
2) *C:\Consyzer.exe* - путь к утилите Consyzer,       
3) *C:\SolutionForAnalysis* - путь к сканируемому решению,        
4) *".exe, .dll"* - расширения бинарных файлов, подлежащих сканированию,        
5) *Release* - конфигурация сборки решения.       




